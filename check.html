<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Check</title>
    <link rel="stylesheet" href="style.css">

    <style>
        /* ซ่อน input file */
        input[type="file"] {
            display: none;
        }

        /* ปุ่มเลือกภาพ */
        label.upload-btn {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
            border-radius: 5px;
            display: inline-block;
        }
    </style>
</head>

<body>

<nav>
    <a href="index.html">Home</a>
    <a href="check.html">Check</a>
    <a href="about.html">About Us</a>
</nav>

<div class="main-content">
    <div class="box">
        <h1>Check</h1>
        <p>หน้านี้ใช้สำหรับตรวจสอบข้อมูล</p>

        <h2>ทำนายภาพปลา</h2>

        <!-- ปุ่มเลือกภาพ -->
        <label for="imageUpload" class="upload-btn">เลือกภาพ</label>
        <input type="file" id="imageUpload" accept="image/*" onchange="loadImage(event)">

        <br><br>

        <!-- แสดงผลลัพธ์ -->
        <div id="result"></div>
    </div>
</div>

<!-- TensorFlow และ Teachable Machine -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

<script>
    const URL = "https://teachablemachine.withgoogle.com/models/6rxh3zyDi/";
    let model;

    // โหลดโมเดลอัตโนมัติ
    async function init() {
        const modelURL = URL + "model.json";
        const metadataURL = URL + "metadata.json";
        model = await tmImage.load(modelURL, metadataURL);
    }

    // อ่านรูปภาพด้วย FileReader (ไม่แสดงภาพ)
    function loadImage(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function () {
            const img = new Image();
            img.src = reader.result;
            img.onload = () => predict(img);
        };
        reader.readAsDataURL(file);
    }

    // แสดงเฉพาะคลาสที่มีค่าความน่าจะเป็นสูงสุด
    async function predict(image) {
        const predictions = await model.predict(image);

        let best = predictions[0];
        for (let i = 1; i < predictions.length; i++) {
            if (predictions[i].probability > best.probability) {
                best = predictions[i];
            }
        }

        document.getElementById("result").innerHTML =
            `คลาส: ${best.className}<br>
             ความน่าจะเป็น: ${best.probability.toFixed(2)}`;
    }

    init();
</script>

</body>
</html>
